{% extends "base_modern.html" %}

{% block title %}Cookies ç®¡ç†ä¸­å¿ƒ - YT-DLP Web{% endblock %}

{% block content %}
<div class="container-fluid" id="cookiesApp">
    
    <!-- ğŸ¨ ç°ä»£åŒ–é¡µé¢æ ‡é¢˜ -->
    <div class="row mb-3">
        <div class="col-lg-8 mx-auto">
            <div class="text-center animate-fade-in-up">
                <h1 class="display-5 fw-bold text-gradient mb-2">
                    <i class="bi bi-cookie me-3"></i>Cookies ç®¡ç†ä¸­å¿ƒ
                </h1>
                <p class="lead text-muted mb-3">
                    ç®¡ç†ç½‘ç«™Cookiesä»¥è·å¾—æœ€ä½³ä¸‹è½½ä½“éªŒå’Œè®¿é—®æƒé™
                </p>
                <div class="d-flex flex-wrap justify-content-center gap-2">
                    <span class="badge rounded-pill px-3 py-2" style="background: var(--gradient-primary); color: white;">
                        <i class="bi bi-upload me-1"></i>æ–‡ä»¶ä¸Šä¼ 
                    </span>
                    <span class="badge rounded-pill px-3 py-2" style="background: var(--gradient-success); color: white;">
                        <i class="bi bi-check-circle me-1"></i>æ ¼å¼éªŒè¯
                    </span>
                    <span class="badge rounded-pill px-3 py-2" style="background: var(--gradient-warning); color: white;">
                        <i class="bi bi-shield me-1"></i>å®‰å…¨å­˜å‚¨
                    </span>
                    <span class="badge rounded-pill px-3 py-2" style="background: var(--gradient-danger); color: white;">
                        <i class="bi bi-tools me-1"></i>è‡ªåŠ¨ä¿®å¤
                    </span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ğŸ“¤ ç°ä»£åŒ–ä¸Šä¼ Cookies -->
    <div class="row mb-3">
        <div class="col-lg-8 mx-auto">
            <div class="modern-card p-4">
                <h5 class="mb-3 fw-bold">
                    <i class="bi bi-upload me-2 text-primary"></i>ä¸Šä¼ Cookiesæ–‡ä»¶
                </h5>
                    
                    <form id="cookiesForm">
                        <div class="row g-3 mb-2">
                        <!-- ğŸŒ ç½‘ç«™é€‰æ‹© -->
                        <div class="col-md-6">
                            <label for="website" class="form-label fw-bold">
                                <i class="bi bi-globe me-1 text-primary"></i>ç›®æ ‡ç½‘ç«™
                            </label>
                            <select class="form-select modern-input" id="website">
                                <option value="">ğŸŒ é€‰æ‹©ç½‘ç«™</option>
                                <option value="youtube">ğŸ“º YouTube</option>
                                <option value="bilibili">ğŸ¬ Bilibili</option>
                                <option value="twitter">ğŸ¦ Twitter/X</option>
                                <option value="instagram">ğŸ“· Instagram</option>
                                <option value="tiktok">ğŸµ TikTok</option>
                                <option value="custom">âš™ï¸ è‡ªå®šä¹‰</option>
                            </select>
                        </div>

                        <!-- ğŸ”§ è‡ªå®šä¹‰ç½‘ç«™å -->
                        <div class="col-md-6" id="customWebsiteDiv" style="display: none;">
                            <label for="customWebsite" class="form-label fw-bold">
                                <i class="bi bi-pencil me-1 text-success"></i>è‡ªå®šä¹‰ç½‘ç«™å
                            </label>
                            <input type="text" class="form-control modern-input" id="customWebsite" placeholder="ä¾‹å¦‚: example.com">
                        </div>
                        </div>
                        
                        <!-- ä¸Šä¼ æ–¹å¼é€‰æ‹© -->
                        <div class="mb-2">
                            <label class="form-label">ä¸Šä¼ æ–¹å¼</label>
                            <div class="d-flex gap-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="uploadMethod" id="fileMethod" value="file" checked>
                                    <label class="form-check-label" for="fileMethod">æ–‡ä»¶ä¸Šä¼ </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="uploadMethod" id="textMethod" value="text">
                                    <label class="form-check-label" for="textMethod">æ–‡æœ¬ç²˜è´´</label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- æ–‡ä»¶ä¸Šä¼  -->
                        <div id="fileUploadDiv" class="mb-2">
                            <label for="cookiesFile" class="form-label">Cookiesæ–‡ä»¶</label>
                            <div class="border border-2 border-dashed rounded p-4 text-center" style="min-height: 200px;">
                                <input type="file" class="form-control d-none" id="cookiesFile" accept=".txt,.json">
                                <div id="fileDropZone" class="d-flex flex-column justify-content-center h-100">
                                    <i class="bi bi-cloud-upload display-4 text-muted mb-3"></i>
                                    <p class="text-muted mb-2">
                                        æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ– 
                                        <button type="button" class="btn btn-link p-0" id="selectFileBtn">ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</button>
                                    </p>
                                    <small class="text-muted">æ”¯æŒ .txt å’Œ .json æ ¼å¼</small>
                                    <div class="mt-2">
                                        <small class="text-muted d-block">â€¢ æ”¯æŒNetscapeæ ¼å¼ (æµè§ˆå™¨å¯¼å‡º)</small>
                                        <small class="text-muted d-block">â€¢ æ”¯æŒJSONæ ¼å¼ (å¼€å‘è€…å·¥å…·)</small>
                                        <small class="text-muted d-block">â€¢ æ”¯æŒé”®å€¼å¯¹æ ¼å¼ (name=value)</small>
                                    </div>
                                </div>
                                <div id="fileSelected" class="d-none">
                                    <i class="bi bi-file-earmark-text display-4 text-success mb-2"></i>
                                    <p class="mb-0" id="fileName"></p>
                                    <button type="button" class="btn btn-sm btn-outline-danger mt-2" id="clearFileBtn">
                                        <i class="bi bi-x"></i> æ¸…é™¤
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- æ–‡æœ¬ç²˜è´´ -->
                        <div id="textUploadDiv" class="mb-2" style="display: none;">
                            <label for="cookiesContent" class="form-label">Cookieså†…å®¹</label>
                            <textarea class="form-control" id="cookiesContent" rows="10" 
                                      placeholder="ç²˜è´´Cookieså†…å®¹...&#10;&#10;æ”¯æŒä»¥ä¸‹æ ¼å¼:&#10;1. Netscapeæ ¼å¼ (æµè§ˆå™¨å¯¼å‡º)&#10;2. JSONæ ¼å¼ (å¼€å‘è€…å·¥å…·)&#10;3. é”®å€¼å¯¹æ ¼å¼ (name=value)"></textarea>
                            <div class="d-flex justify-content-between mt-2">
                                <small class="text-muted" id="charCount">0 å­—ç¬¦</small>
                                <div class="btn-group btn-group-sm">
                                    <button type="button" class="btn btn-outline-secondary" id="clearTextBtn">æ¸…ç©º</button>
                                    <button type="button" class="btn btn-outline-primary" id="formatBtn">æ ¼å¼åŒ–</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- æ ¼å¼è¯´æ˜ -->
                        <div class="modern-card p-4" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);">
                            <div class="d-flex justify-content-between align-items-center text-white">
                                <h6 class="mb-0 fw-bold">æ”¯æŒçš„æ ¼å¼</h6>
                                <button type="button" class="btn btn-sm btn-outline-light" id="toggleExamples">
                                    æŸ¥çœ‹ç¤ºä¾‹
                                </button>
                            </div>
                            <ul class="mb-0 mt-2 text-white">
                                <li><strong>Netscapeæ ¼å¼</strong>: æµè§ˆå™¨å¯¼å‡ºçš„æ ‡å‡†æ ¼å¼</li>
                                <li><strong>JSONæ ¼å¼</strong>: å¼€å‘è€…å·¥å…·å¯¼å‡ºçš„æ ¼å¼</li>
                                <li><strong>é”®å€¼å¯¹æ ¼å¼</strong>: ç®€å•çš„ name=value æ ¼å¼</li>
                                <li><strong>è‡ªåŠ¨æ£€æµ‹</strong>: ç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«æ ¼å¼å¹¶è½¬æ¢</li>
                            </ul>

                            <!-- æ ¼å¼ç¤ºä¾‹ -->
                            <div id="formatExamples" class="mt-3" style="display: none;">
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <h6 class="text-white">Netscapeæ ¼å¼:</h6>
                                        <pre class="small bg-white bg-opacity-25 text-white p-2 rounded"># Netscape HTTP Cookie File
.youtube.com	TRUE	/	FALSE	1234567890	session_token	abc123</pre>
                                    </div>
                                    <div class="col-md-4">
                                        <h6 class="text-white">JSONæ ¼å¼:</h6>
                                        <pre class="small bg-white bg-opacity-25 text-white p-2 rounded">[{
  "name": "session_token",
  "value": "abc123",
  "domain": ".youtube.com"
}]</pre>
                                    </div>
                                    <div class="col-md-4">
                                        <h6 class="text-white">é”®å€¼å¯¹æ ¼å¼:</h6>
                                        <pre class="small bg-white bg-opacity-25 text-white p-2 rounded">session_token=abc123
secure_token=def456
user_id=12345</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    <!-- ğŸ›ï¸ æ“ä½œæŒ‰é’® -->
                    <div class="d-flex gap-3 flex-wrap">
                        <button type="button" class="btn btn-outline-success modern-btn" id="validateBtn">
                            <i class="bi bi-check-circle me-2"></i>éªŒè¯æ ¼å¼
                        </button>
                        <button type="submit" class="btn btn-primary modern-btn py-3 px-5"
                                style="background: var(--gradient-primary); border: none; font-size: 1.1rem;">
                            <i class="bi bi-upload me-2"></i>ä¸Šä¼ Cookies
                        </button>
                    </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ğŸ’¾ ç°ä»£åŒ–å·²ä¿å­˜çš„Cookies -->
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="modern-card p-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0 fw-bold">
                        <i class="bi bi-database me-2 text-primary"></i>å·²ä¿å­˜çš„Cookies
                        <span class="badge rounded-pill ms-2" style="background: var(--gradient-secondary); color: white;" id="cookiesCount">0</span>
                    </h5>
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-outline-primary modern-btn" id="refreshBtn">
                            <i class="bi bi-arrow-clockwise me-1"></i>åˆ·æ–°
                        </button>
                        <button type="button" class="btn btn-outline-warning modern-btn" id="fixBtn">
                            <i class="bi bi-tools me-1"></i>ä¿®å¤æ ¼å¼
                        </button>
                    </div>
                </div>
                    
                    <!-- ç©ºçŠ¶æ€ -->
                    <div id="emptyState" class="text-center py-5">
                        <i class="bi bi-cookie display-4 text-muted"></i>
                        <h6 class="mt-3 text-muted">æš‚æ— ä¿å­˜çš„Cookies</h6>
                        <p class="text-muted">ä¸Šä¼ ä¸€äº›Cookiesæ–‡ä»¶æ¥å¼€å§‹ä½¿ç”¨</p>
                    </div>
                    
                    <!-- Cookiesåˆ—è¡¨ -->
                    <div id="cookiesList" class="d-none">
                        <!-- åŠ¨æ€ç”Ÿæˆçš„å†…å®¹ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
{% endblock %}

{% block extra_scripts %}
<script>
class CookiesApp {
    constructor() {
        this.uploadForm = {
            website: '',
            customWebsite: '',
            method: 'file',
            file: null,
            content: ''
        };
        this.cookies = [];
        this.showExamples = false;

        this.init();
    }

    init() {
        this.bindEvents();
        this.loadCookies();
    }

    bindEvents() {
        // è¡¨å•æäº¤
        document.getElementById('cookiesForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.uploadCookies();
        });

        // ç½‘ç«™é€‰æ‹©
        document.getElementById('website').addEventListener('change', (e) => {
            this.uploadForm.website = e.target.value;
            this.toggleCustomWebsite(e.target.value === 'custom');
        });

        // è‡ªå®šä¹‰ç½‘ç«™å
        document.getElementById('customWebsite').addEventListener('input', (e) => {
            this.uploadForm.customWebsite = e.target.value;
        });

        // ä¸Šä¼ æ–¹å¼åˆ‡æ¢
        document.querySelectorAll('input[name="uploadMethod"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                this.uploadForm.method = e.target.value;
                this.toggleUploadMethod(e.target.value);
            });
        });

        // æ–‡ä»¶é€‰æ‹©
        document.getElementById('selectFileBtn').addEventListener('click', () => {
            document.getElementById('cookiesFile').click();
        });

        document.getElementById('cookiesFile').addEventListener('change', (e) => {
            this.handleFileSelect(e.target.files[0]);
        });

        // æ¸…é™¤æ–‡ä»¶
        document.getElementById('clearFileBtn').addEventListener('click', () => {
            this.clearFile();
        });

        // æ–‡æœ¬å†…å®¹
        document.getElementById('cookiesContent').addEventListener('input', (e) => {
            this.uploadForm.content = e.target.value;
            this.updateCharCount();
        });

        // æ–‡æœ¬æ“ä½œæŒ‰é’®
        document.getElementById('clearTextBtn').addEventListener('click', () => {
            document.getElementById('cookiesContent').value = '';
            this.uploadForm.content = '';
            this.updateCharCount();
        });

        document.getElementById('formatBtn').addEventListener('click', () => {
            this.formatContent();
        });

        // ç¤ºä¾‹åˆ‡æ¢
        document.getElementById('toggleExamples').addEventListener('click', () => {
            this.toggleExamples();
        });

        // éªŒè¯æŒ‰é’®
        document.getElementById('validateBtn').addEventListener('click', () => {
            this.validateCookies();
        });

        // åˆ·æ–°æŒ‰é’®
        document.getElementById('refreshBtn').addEventListener('click', () => {
            this.loadCookies();
        });

        // ä¿®å¤æŒ‰é’®
        document.getElementById('fixBtn').addEventListener('click', () => {
            this.fixCookies();
        });

        // æ‹–æ‹½æ”¯æŒ
        const dropZone = document.getElementById('fileDropZone');
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('border-primary');
        });

        dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-primary');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-primary');
            const file = e.dataTransfer.files[0];
            if (file) {
                this.handleFileSelect(file);
            }
        });
    }

    toggleCustomWebsite(show) {
        const div = document.getElementById('customWebsiteDiv');
        div.style.display = show ? 'block' : 'none';
    }

    toggleUploadMethod(method) {
        const fileDiv = document.getElementById('fileUploadDiv');
        const textDiv = document.getElementById('textUploadDiv');

        if (method === 'file') {
            fileDiv.style.display = 'block';
            textDiv.style.display = 'none';
        } else {
            fileDiv.style.display = 'none';
            textDiv.style.display = 'block';
        }
    }

    handleFileSelect(file) {
        if (file) {
            this.uploadForm.file = file;
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileDropZone').classList.add('d-none');
            document.getElementById('fileSelected').classList.remove('d-none');
        }
    }

    clearFile() {
        this.uploadForm.file = null;
        document.getElementById('cookiesFile').value = '';
        document.getElementById('fileDropZone').classList.remove('d-none');
        document.getElementById('fileSelected').classList.add('d-none');
    }

    updateCharCount() {
        const count = this.uploadForm.content.length;
        document.getElementById('charCount').textContent = `${count} å­—ç¬¦`;
    }

    toggleExamples() {
        const examples = document.getElementById('formatExamples');
        const btn = document.getElementById('toggleExamples');

        this.showExamples = !this.showExamples;
        examples.style.display = this.showExamples ? 'block' : 'none';
        btn.textContent = this.showExamples ? 'éšè—ç¤ºä¾‹' : 'æŸ¥çœ‹ç¤ºä¾‹';
    }

    formatContent() {
        const content = this.uploadForm.content.trim();
        if (!content) return;

        try {
            // å°è¯•æ ¼å¼åŒ–JSON
            const parsed = JSON.parse(content);
            document.getElementById('cookiesContent').value = JSON.stringify(parsed, null, 2);
            this.uploadForm.content = document.getElementById('cookiesContent').value;
            this.updateCharCount();
            showNotification('å†…å®¹å·²æ ¼å¼åŒ–', 'success');
        } catch (error) {
            showNotification('æ— æ³•æ ¼å¼åŒ–å†…å®¹ï¼Œè¯·æ£€æŸ¥æ ¼å¼', 'warning');
        }
    }

    async validateCookies() {
        if (!this.hasContent()) {
            showNotification('è¯·å…ˆè¾“å…¥æˆ–é€‰æ‹©Cookieså†…å®¹', 'warning');
            return;
        }

        try {
            let content = '';

            if (this.uploadForm.method === 'file' && this.uploadForm.file) {
                content = await this.readFileContent(this.uploadForm.file);
            } else {
                content = this.uploadForm.content;
            }

            const response = await apiRequest('/cookies/api/validate', {
                method: 'POST',
                body: JSON.stringify({ cookies: content })
            });

            if (response.ok) {
                const data = await response.json();
                if (data.success) {
                    showNotification(
                        `éªŒè¯æˆåŠŸï¼æ ¼å¼: ${data.format}ï¼ŒåŒ…å« ${data.count} ä¸ªCookie`,
                        'success'
                    );
                } else {
                    showNotification(data.error || 'éªŒè¯å¤±è´¥', 'danger');
                }
            } else {
                const data = await response.json();
                showNotification(data.error || 'éªŒè¯å¤±è´¥', 'danger');
            }
        } catch (error) {
            console.error('éªŒè¯å¤±è´¥:', error);
            showNotification('éªŒè¯è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯', 'danger');
        }
    }

    async readFileContent(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = (e) => resolve(e.target.result);
            reader.onerror = (e) => reject(e);
            reader.readAsText(file);
        });
    }

    hasContent() {
        return this.uploadForm.method === 'file' ?
               this.uploadForm.file :
               this.uploadForm.content.trim();
    }

    canUpload() {
        const hasWebsite = this.uploadForm.website &&
                          (this.uploadForm.website !== 'custom' || this.uploadForm.customWebsite);
        const hasContent = this.hasContent();
        return hasWebsite && hasContent;
    }

    async uploadCookies() {
        if (!this.canUpload()) {
            showNotification('è¯·å®Œæ•´å¡«å†™è¡¨å•', 'warning');
            return;
        }

        try {
            const formData = new FormData();
            formData.append('website', this.uploadForm.website === 'custom' ?
                           this.uploadForm.customWebsite : this.uploadForm.website);

            if (this.uploadForm.method === 'file') {
                formData.append('file', this.uploadForm.file);
            } else {
                formData.append('content', this.uploadForm.content);
            }

            const response = await apiRequest('/cookies/api/upload', {
                method: 'POST',
                body: formData,
                headers: {} // è®©æµè§ˆå™¨è‡ªåŠ¨è®¾ç½®Content-Type
            });

            if (response.ok) {
                showNotification('Cookiesä¸Šä¼ æˆåŠŸ', 'success');
                this.resetForm();
                await this.loadCookies();
            } else {
                const data = await response.json();
                showNotification(data.error || 'Cookiesä¸Šä¼ å¤±è´¥', 'danger');
            }
        } catch (error) {
            console.error('ä¸Šä¼ å¤±è´¥:', error);
            showNotification('ä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯', 'danger');
        }
    }

    resetForm() {
        this.uploadForm = {
            website: '',
            customWebsite: '',
            method: 'file',
            file: null,
            content: ''
        };

        document.getElementById('cookiesForm').reset();
        this.clearFile();
        this.toggleCustomWebsite(false);
        this.updateCharCount();
    }

    async loadCookies() {
        try {
            const response = await apiRequest('/cookies/api/list');
            if (response.ok) {
                const data = await response.json();
                this.cookies = data.cookies || [];
                this.renderCookies();
            }
        } catch (error) {
            console.error('åŠ è½½Cookieså¤±è´¥:', error);
        }
    }

    renderCookies() {
        const emptyState = document.getElementById('emptyState');
        const cookiesList = document.getElementById('cookiesList');
        const countBadge = document.getElementById('cookiesCount');

        countBadge.textContent = this.cookies.length;

        if (this.cookies.length === 0) {
            emptyState.classList.remove('d-none');
            cookiesList.classList.add('d-none');
            return;
        }

        emptyState.classList.add('d-none');
        cookiesList.classList.remove('d-none');

        cookiesList.innerHTML = this.cookies.map(cookie => `
            <div class="border rounded p-3 mb-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-3"
                             style="width: 40px; height: 40px;">
                            ${cookie.website.charAt(0).toUpperCase()}
                        </div>
                        <div>
                            <h6 class="mb-1">${this.getWebsiteName(cookie.website)}</h6>
                            <small class="text-muted">
                                ${cookie.count} ä¸ªCookie â€¢ ä¸Šä¼ äº ${this.formatDate(cookie.created_at)}
                            </small>
                        </div>
                    </div>

                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-primary" onclick="app.testCookies('${cookie.website}')" title="æµ‹è¯•">
                            <i class="bi bi-check-circle"></i>
                        </button>
                        <button class="btn btn-outline-success" onclick="app.downloadCookies('${cookie.website}')" title="å¯¼å‡º">
                            <i class="bi bi-download"></i>
                        </button>
                        <button class="btn btn-outline-danger" onclick="app.deleteCookies('${cookie.website}')" title="åˆ é™¤">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        `).join('');
    }

    getWebsiteName(website) {
        const names = {
            'youtube': 'YouTube',
            'bilibili': 'Bilibili',
            'twitter': 'Twitter/X',
            'instagram': 'Instagram',
            'tiktok': 'TikTok'
        };
        return names[website] || website;
    }

    // ä½¿ç”¨æœåŠ¡å±‚çš„æ ¼å¼åŒ–å‡½æ•°
    formatDate(dateString) {
        return window.appManager?.services?.download?.formatDate(dateString) || '';
    }

    async testCookies(website) {
        try {
            const response = await apiRequest(`/cookies/api/test/${website}`, {
                method: 'POST'
            });

            if (response.ok) {
                const data = await response.json();
                showNotification(data.success ? 'Cookiesæµ‹è¯•æˆåŠŸ' : 'Cookiesæµ‹è¯•å¤±è´¥',
                               data.success ? 'success' : 'warning');
            } else {
                showNotification('æµ‹è¯•å¤±è´¥', 'danger');
            }
        } catch (error) {
            showNotification('ç½‘ç»œé”™è¯¯', 'danger');
        }
    }

    downloadCookies(website) {
        window.open(`/cookies/api/download/${website}`, '_blank');
    }

    async deleteCookies(website) {
        if (!confirm(`ç¡®å®šè¦åˆ é™¤ ${this.getWebsiteName(website)} çš„Cookieså—ï¼Ÿ`)) return;

        try {
            const response = await apiRequest(`/cookies/api/delete/${website}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                showNotification('Cookiesåˆ é™¤æˆåŠŸ', 'success');
                await this.loadCookies();
            } else {
                showNotification('åˆ é™¤å¤±è´¥', 'danger');
            }
        } catch (error) {
            showNotification('ç½‘ç»œé”™è¯¯', 'danger');
        }
    }

    async fixCookies() {
        if (!confirm('ç¡®å®šè¦ä¿®å¤æ‰€æœ‰Cookiesæ ¼å¼å—ï¼Ÿ')) return;

        try {
            const response = await apiRequest('/cookies/api/fix-cookies', {
                method: 'POST'
            });

            if (response.ok) {
                showNotification('Cookiesæ ¼å¼ä¿®å¤å®Œæˆ', 'success');
                await this.loadCookies();
            } else {
                showNotification('ä¿®å¤å¤±è´¥', 'danger');
            }
        } catch (error) {
            showNotification('ç½‘ç»œé”™è¯¯', 'danger');
        }
    }
}

// åˆå§‹åŒ–åº”ç”¨
let app;
document.addEventListener('DOMContentLoaded', () => {
    app = new CookiesApp();
});
</script>
{% endblock %}
